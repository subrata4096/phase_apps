#include "irsdefs.h"
#include "irs.h"
#include "irstdiff.h"
#include "FunctionTimer.h"
#include "RadiationData.h"
void divgrad3( double *x, double *y, double *z,   RadiationData_t *rblk,
               Domain_t *domain,  double *phi, double *flmt,
               double umin, double fscl )
{
   char *me = "divgrad3";
   double *t0c1, *t0c2, *t0c3 ;
   double *t0c4, *t0c5, *t0c6 ;
   double *t1c1, *t1c2, *t1c3 ;
   double *t1c4, *t1c5, *t1c6 ;
   double *t2c1, *t2c2, *t2c3 ;
   double *t2c4, *t2c5, *t2c6 ;
   double *t3c1, *t3c2, *t3c3 ;
   double *t3c4, *t3c5, *t3c6 ;
   double *t4c1, *t4c2, *t4c3 ;
   double *t4c4, *t4c5, *t4c6 ;
   double *t5c1, *t5c2, *t5c3 ;
   double *t5c4, *t5c5, *t5c6 ;
   double *t6c1, *t6c2, *t6c3 ;
   double *t6c4, *t6c5, *t6c6 ;
   double *t7c1, *t7c2, *t7c3 ;
   double *t7c4, *t7c5, *t7c6 ;
   double *t8c1, *t8c2, *t8c3 ;
   double *t8c4, *t8c5, *t8c6 ;
   double *t9c1, *t9c2, *t9c3 ;
   double *t9c4, *t9c5, *t9c6 ;
   double dax, day, daz ;
   double dbx, dby, dbz ;
   double dcx, dcy, dcz ;
   double ddx, ddy, ddz ;
   double dotx ;
   double *phi1, *phi2, *phi3, *phi4 ;
   double *phi5, *phi6, *phi7, *phi8 ;
   double  phia,  phib,  phic,  phid ;
   double  flmtx, flmty, flmtz ;
   int i ;
   double w, wl ;
   double *xc, *yc, *zc ;
   double *x1, *y1, *z1 ;
   double *x2, *y2, *z2 ;
   double *x3, *y3, *z3 ;
   double *x4, *y4, *z4 ;
   double *x5, *y5, *z5 ;
   double *x6, *y6, *z6 ;
   double *x7, *y7, *z7 ;
   double *x8, *y8, *z8 ;
   double xab, yab, zab ;
   double x21, y21, z21 ;
   double x31, y31, z31 ;
   double x32, y32, z32 ;
   double x41, y41, z41 ;
   double x42, y42, z42 ;
   double x43, y43, z43 ;
   double x51, y51, z51 ;
   double x52, y52, z52 ;
   double x54, y54, z54 ;
   double x61, y61, z61 ;
   double x62, y62, z62 ;
   double x63, y63, z63 ;
   double x65, y65, z65 ;
   double x72, y72, z72 ;
   double x73, y73, z73 ;
   double x74, y74, z74 ;
   double x75, y75, z75 ;
   double x76, y76, z76 ;
   double x81, y81, z81 ;
   double x83, y83, z83 ;
   double x84, y84, z84 ;
   double x85, y85, z85 ;
   double x86, y86, z86 ;
   double x87, y87, z87 ;
   double s32xs21x, s32xs21y, s32xs21z ;
   double s41xs21x, s41xs21y, s41xs21z ;
   double s43xs32x, s43xs32y, s43xs32z ;
   double s43xs41x, s43xs41y, s43xs41z ;
   double s51xs21x, s51xs21y, s51xs21z ;
   double s51xs41x, s51xs41y, s51xs41z ;
   double s52xs42x, s52xs42y, s52xs42z ;
   double s61xs31x, s61xs31y, s61xs31z ;
   double s62xs21x, s62xs21y, s62xs21z ;
   double s62xs32x, s62xs32y, s62xs32z ;
   double s63xs61x, s63xs61y, s63xs61z ;
   double s65xs51x, s65xs51y, s65xs51z ;
   double s65xs62x, s65xs62y, s65xs62z ;
   double s72xs42x, s72xs42y, s72xs42z ;
   double s72xs52x, s72xs52y, s72xs52z ;
   double s73xs32x, s73xs32y, s73xs32z ;
   double s73xs43x, s73xs43y, s73xs43z ;
   double s74xs54x, s74xs54y, s74xs54z ;
   double s74xs72x, s74xs72y, s74xs72z ;
   double s75xs72x, s75xs72y, s75xs72z ;
   double s75xs74x, s75xs74y, s75xs74z ;
   double s76xs62x, s76xs62y, s76xs62z ;
   double s76xs65x, s76xs65y, s76xs65z ;
   double s76xs73x, s76xs73y, s76xs73z ;
   double s81xs31x, s81xs31y, s81xs31z ;
   double s81xs61x, s81xs61y, s81xs61z ;
   double s83xs63x, s83xs63y, s83xs63z ;
   double s84xs41x, s84xs41y, s84xs41z ;
   double s84xs43x, s84xs43y, s84xs43z ;
   double s85xs51x, s85xs51y, s85xs51z ;
   double s85xs65x, s85xs65y, s85xs65z ;
   double s85xs84x, s85xs84y, s85xs84z ;
   double s86xs61x, s86xs61y, s86xs61z ;
   double s86xs63x, s86xs63y, s86xs63z ;
   double s87xs73x, s87xs73y, s87xs73z ;
   double s87xs76x, s87xs76y, s87xs76z ;
   double s87xs84x, s87xs84y, s87xs84z ;
   double s87xs85x, s87xs85y, s87xs85z ;
   double twelfth = -0.08333333 ;
   double myflops = 0.0;
   FT_INITIALIZE(me, domain->hash)
#define FWDSET8(v,v1,v2,v3,v4,v5,v6,v7,v8)  \
   v4 = v ;           \
   v1 = v  + 1 ;      \
   v2 = v1 + domain->jp ;    \
   v3 = v4 + domain->jp ;    \
   v5 = v1 + domain->kp ;    \
   v6 = v2 + domain->kp ;    \
   v7 = v3 + domain->kp ;    \
   v8 = v4 + domain->kp ;
#define BACKSET8(v,v1,v2,v3,v4,v5,v6,v7,v8)  \
   v6 = v ;           \
   v7 = v  - 1 ;      \
   v5 = v6 - domain->jp ;    \
   v8 = v7 - domain->jp ;    \
   v1 = v5 - domain->kp ;    \
   v2 = v6 - domain->kp ;    \
   v3 = v7 - domain->kp ;    \
   v4 = v8 - domain->kp ;
#define SUM8(a1,a2,a3,a4,a5,a6,a7,a8) \
 (a1[i] + a2[i] + a3[i] + a4[i] + a5[i] + a6[i] + a7[i] + a8[i])
   fscl *= 8.0 ;
   xc = MALLOT(double,domain->nnalls) ;
   yc = MALLOT(double,domain->nnalls) ;
   zc = MALLOT(double,domain->nnalls) ;
   for ( i = 0 ; i < domain->nnalls ; i++ ) {
      xc[i] = 0.0 ;
      yc[i] = 0.0 ;
      zc[i] = 0.0 ;
   }
   FWDSET8(x,x1,x2,x3,x4,x5,x6,x7,x8) ;
   FWDSET8(y,y1,y2,y3,y4,y5,y6,y7,y8) ;
   FWDSET8(z,z1,z2,z3,z4,z5,z6,z7,z8) ;
   for ( i = domain->fpz ; i <= domain->lpz ; i++ ) {
      xc[i] = 0.125*SUM8(x1,x2,x3,x4,x5,x6,x7,x8) ;
      yc[i] = 0.125*SUM8(y1,y2,y3,y4,y5,y6,y7,y8) ;
      zc[i] = 0.125*SUM8(z1,z2,z3,z4,z5,z6,z7,z8) ;
   }
   myflops += 24.0 * ( domain->lpz - domain->fpz + 1 ) ;
   BACKSET8(xc,x1,x2,x3,x4,x5,x6,x7,x8) ;
   BACKSET8(yc,y1,y2,y3,y4,y5,y6,y7,y8) ;
   BACKSET8(zc,z1,z2,z3,z4,z5,z6,z7,z8) ;
   BACKSET8(phi,phi1,phi2,phi3,phi4,phi5,phi6,phi7,phi8) ;
   for ( i = domain->fpz ; i <= domain->lpz ; i++ )
   {
      rblk->dbl[i] = 0.0 ;
      rblk->dbc[i] = 0.0 ;
      rblk->dbr[i] = 0.0 ;
      rblk->dcl[i] = 0.0 ;
      rblk->dcc[i] = 0.0 ;
      rblk->dcr[i] = 0.0 ;
      rblk->dfl[i] = 0.0 ;
      rblk->dfc[i] = 0.0 ;
      rblk->dfr[i] = 0.0 ;
      rblk->cbl[i] = 0.0 ;
      rblk->cbc[i] = 0.0 ;
      rblk->cbr[i] = 0.0 ;
      rblk->ccl[i] = 0.0 ;
      rblk->ccc[i] = 0.0 ;
      flmt[i] = 0.0 ;
   }
      t0c1 = rblk->cbc - domain->kp ;
      t0c2 = rblk->dcc - domain->jp ;
      t0c3 = rblk->ccl - domain->kp - domain->jp ;
      t0c4 = rblk->dfc - domain->jp ;
      t0c5 = rblk->cbl - domain->kp ;
      t0c6 = rblk->dcl - domain->jp ;
      t1c1 = rblk->ccl - domain->kp ;
      t1c2 = rblk->cbc - domain->kp - 1 ;
      t1c3 = rblk->dcc - 1 ;
      t1c4 = rblk->cbl - domain->kp ;
      t1c5 = rblk->dcr - 1 ;
      t1c6 = rblk->dbc - 1 ;
      t2c1 = rblk->dcc ;
      t2c2 = rblk->ccl ;
      t2c3 = rblk->cbc ;
      t2c4 = rblk->dcr - 1 ;
      t2c5 = rblk->dfc - domain->jp ;
      t2c6 = rblk->cbr - 1 ;
      t3c1 = rblk->dcc - domain->jp - 1 ;
      t3c2 = rblk->ccl - domain->jp ;
      t3c3 = rblk->cbc - 1 ;
      t3c4 = rblk->dcl - domain->jp ;
      t3c5 = rblk->dbc - 1 ;
      t3c6 = rblk->cbr - 1 ;
      t4c1 = rblk->dcr - 1 ;
      t4c2 = rblk->dbc - 1 ;
      t4c3 = rblk->cbr - 1 ;
      t4c4 = rblk->cbl - domain->kp ;
      t4c5 = rblk->dfc - domain->jp ;
      t4c6 = rblk->dcl - domain->jp ;
      t5c1 = rblk->cbc - domain->kp ;
      t5c2 = rblk->ccl - domain->kp ;
      t5c3 = rblk->dcc ;
      t5c4 = rblk->cbr - domain->kp - 1 ;
      t5c5 = rblk->dbc ;
      t5c6 = rblk->dcl ;
      t6c1 = rblk->ccl - domain->kp - domain->jp ;
      t6c2 = rblk->dcc - domain->jp - 1 ;
      t6c3 = rblk->cbc - domain->kp - 1 ;
      t6c4 = rblk->dcr - domain->jp - 1 ;
      t6c5 = rblk->cbr - domain->kp - 1 ;
      t6c6 = rblk->dfc - domain->jp - 1 ;
      t7c1 = rblk->dcc - domain->jp ;
      t7c2 = rblk->cbc ;
      t7c3 = rblk->ccl - domain->jp ;
      t7c4 = rblk->dbc ;
      t7c5 = rblk->dcr - domain->jp - 1 ;
      t7c6 = rblk->cbl ;
      t8c1 = rblk->dcc - 1 ;
      t8c2 = rblk->cbc - 1 ;
      t8c3 = rblk->ccl ;
      t8c4 = rblk->dfc - domain->jp - 1 ;
      t8c5 = rblk->dcl ;
      t8c6 = rblk->cbl ;
      t9c1 = rblk->dbc ;
      t9c2 = rblk->dcl ;
      t9c3 = rblk->cbl ;
      t9c4 = rblk->cbr - domain->kp - 1 ;
      t9c5 = rblk->dcr - domain->jp - 1 ;
      t9c6 = rblk->dfc - domain->jp - 1 ;
   for ( i = domain->frn ; i <= domain->lpn ; i++ )
   {
      x21 = x2[i] - x1[i] ;
      y21 = y2[i] - y1[i] ;
      z21 = z2[i] - z1[i] ;
      x31 = x3[i] - x1[i] ;
      y31 = y3[i] - y1[i] ;
      z31 = z3[i] - z1[i] ;
      x32 = x3[i] - x2[i] ;
      y32 = y3[i] - y2[i] ;
      z32 = z3[i] - z2[i] ;
      x41 = x4[i] - x1[i] ;
      y41 = y4[i] - y1[i] ;
      z41 = z4[i] - z1[i] ;
      x42 = x4[i] - x2[i] ;
      y42 = y4[i] - y2[i] ;
      z42 = z4[i] - z2[i] ;
      x43 = x4[i] - x3[i] ;
      y43 = y4[i] - y3[i] ;
      z43 = z4[i] - z3[i] ;
      x51 = x5[i] - x1[i] ;
      y51 = y5[i] - y1[i] ;
      z51 = z5[i] - z1[i] ;
      x52 = x5[i] - x2[i] ;
      y52 = y5[i] - y2[i] ;
      z52 = z5[i] - z2[i] ;
      x54 = x5[i] - x4[i] ;
      y54 = y5[i] - y4[i] ;
      z54 = z5[i] - z4[i] ;
      x61 = x6[i] - x1[i] ;
      y61 = y6[i] - y1[i] ;
      z61 = z6[i] - z1[i] ;
      x62 = x6[i] - x2[i] ;
      y62 = y6[i] - y2[i] ;
      z62 = z6[i] - z2[i] ;
      x63 = x6[i] - x3[i] ;
      y63 = y6[i] - y3[i] ;
      z63 = z6[i] - z3[i] ;
      x65 = x6[i] - x5[i] ;
      y65 = y6[i] - y5[i] ;
      z65 = z6[i] - z5[i] ;
      x72 = x7[i] - x2[i] ;
      y72 = y7[i] - y2[i] ;
      z72 = z7[i] - z2[i] ;
      x73 = x7[i] - x3[i] ;
      y73 = y7[i] - y3[i] ;
      z73 = z7[i] - z3[i] ;
      x74 = x7[i] - x4[i] ;
      y74 = y7[i] - y4[i] ;
      z74 = z7[i] - z4[i] ;
      x75 = x7[i] - x5[i] ;
      y75 = y7[i] - y5[i] ;
      z75 = z7[i] - z5[i] ;
      x76 = x7[i] - x6[i] ;
      y76 = y7[i] - y6[i] ;
      z76 = z7[i] - z6[i] ;
      x81 = x8[i] - x1[i] ;
      y81 = y8[i] - y1[i] ;
      z81 = z8[i] - z1[i] ;
      x83 = x8[i] - x3[i] ;
      y83 = y8[i] - y3[i] ;
      z83 = z8[i] - z3[i] ;
      x84 = x8[i] - x4[i] ;
      y84 = y8[i] - y4[i] ;
      z84 = z8[i] - z4[i] ;
      x85 = x8[i] - x5[i] ;
      y85 = y8[i] - y5[i] ;
      z85 = z8[i] - z5[i] ;
      x86 = x8[i] - x6[i] ;
      y86 = y8[i] - y6[i] ;
      z86 = z8[i] - z6[i] ;
      x87 = x8[i] - x7[i] ;
      y87 = y8[i] - y7[i] ;
      z87 = z8[i] - z7[i] ;
      CROSSPROD( s32xs21x,s32xs21y,s32xs21z, x32,y32,z32, x21,y21,z21 ) ;
      CROSSPROD( s41xs21x,s41xs21y,s41xs21z, x41,y41,z41, x21,y21,z21 ) ;
      CROSSPROD( s43xs32x,s43xs32y,s43xs32z, x43,y43,z43, x32,y32,z32 ) ;
      CROSSPROD( s43xs41x,s43xs41y,s43xs41z, x43,y43,z43, x41,y41,z41 ) ;
      CROSSPROD( s51xs21x,s51xs21y,s51xs21z, x51,y51,z51, x21,y21,z21 ) ;
      CROSSPROD( s51xs41x,s51xs41y,s51xs41z, x51,y51,z51, x41,y41,z41 ) ;
      CROSSPROD( s52xs42x,s52xs42y,s52xs42z, x52,y52,z52, x42,y42,z42 ) ;
      CROSSPROD( s61xs31x,s61xs31y,s61xs31z, x61,y61,z61, x31,y31,z31 ) ;
      CROSSPROD( s62xs21x,s62xs21y,s62xs21z, x62,y62,z62, x21,y21,z21 ) ;
      CROSSPROD( s62xs32x,s62xs32y,s62xs32z, x62,y62,z62, x32,y32,z32 ) ;
      CROSSPROD( s63xs61x,s63xs61y,s63xs61z, x63,y63,z63, x61,y61,z61 ) ;
      CROSSPROD( s65xs51x,s65xs51y,s65xs51z, x65,y65,z65, x51,y51,z51 ) ;
      CROSSPROD( s65xs62x,s65xs62y,s65xs62z, x65,y65,z65, x62,y62,z62 ) ;
      CROSSPROD( s72xs42x,s72xs42y,s72xs42z, x72,y72,z72, x42,y42,z42 ) ;
      CROSSPROD( s72xs52x,s72xs52y,s72xs52z, x72,y72,z72, x52,y52,z52 ) ;
      CROSSPROD( s73xs32x,s73xs32y,s73xs32z, x73,y73,z73, x32,y32,z32 ) ;
      CROSSPROD( s73xs43x,s73xs43y,s73xs43z, x73,y73,z73, x43,y43,z43 ) ;
      CROSSPROD( s74xs54x,s74xs54y,s74xs54z, x74,y74,z74, x54,y54,z54 ) ;
      CROSSPROD( s74xs72x,s74xs72y,s74xs72z, x74,y74,z74, x72,y72,z72 ) ;
      CROSSPROD( s75xs72x,s75xs72y,s75xs72z, x75,y75,z75, x72,y72,z72 ) ;
      CROSSPROD( s75xs74x,s75xs74y,s75xs74z, x75,y75,z75, x74,y74,z74 ) ;
      CROSSPROD( s76xs62x,s76xs62y,s76xs62z, x76,y76,z76, x62,y62,z62 ) ;
      CROSSPROD( s76xs65x,s76xs65y,s76xs65z, x76,y76,z76, x65,y65,z65 ) ;
      CROSSPROD( s76xs73x,s76xs73y,s76xs73z, x76,y76,z76, x73,y73,z73 ) ;
      CROSSPROD( s81xs31x,s81xs31y,s81xs31z, x81,y81,z81, x31,y31,z31 ) ;
      CROSSPROD( s81xs61x,s81xs61y,s81xs61z, x81,y81,z81, x61,y61,z61 ) ;
      CROSSPROD( s83xs63x,s83xs63y,s83xs63z, x83,y83,z83, x63,y63,z63 ) ;
      CROSSPROD( s84xs41x,s84xs41y,s84xs41z, x84,y84,z84, x41,y41,z41 ) ;
      CROSSPROD( s84xs43x,s84xs43y,s84xs43z, x84,y84,z84, x43,y43,z43 ) ;
      CROSSPROD( s85xs51x,s85xs51y,s85xs51z, x85,y85,z85, x51,y51,z51 ) ;
      CROSSPROD( s85xs65x,s85xs65y,s85xs65z, x85,y85,z85, x65,y65,z65 ) ;
      CROSSPROD( s85xs84x,s85xs84y,s85xs84z, x85,y85,z85, x84,y84,z84 ) ;
      CROSSPROD( s86xs61x,s86xs61y,s86xs61z, x86,y86,z86, x61,y61,z61 ) ;
      CROSSPROD( s86xs63x,s86xs63y,s86xs63z, x86,y86,z86, x63,y63,z63 ) ;
      CROSSPROD( s87xs73x,s87xs73y,s87xs73z, x87,y87,z87, x73,y73,z73 ) ;
      CROSSPROD( s87xs76x,s87xs76y,s87xs76z, x87,y87,z87, x76,y76,z76 ) ;
      CROSSPROD( s87xs84x,s87xs84y,s87xs84z, x87,y87,z87, x84,y84,z84 ) ;
      CROSSPROD( s87xs85x,s87xs85y,s87xs85z, x87,y87,z87, x85,y85,z85 ) ;
      xab = -x21 ;  yab = -y21 ;  zab = -z21 ;
      dax =  s52xs42x ;  day =  s52xs42y ;  daz =  s52xs42z ;
      dbx = -s51xs41x ;  dby = -s51xs41y ;  dbz = -s51xs41z ;
      dcx = -s41xs21x ;  dcy = -s41xs21y ;  dcz = -s41xs21z ;
      ddx =  s51xs21x ;  ddy =  s51xs21y ;  ddz =  s51xs21z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t0c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t0c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t0c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t0c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t0c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t0c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi1[i] ; phib = phi2[i] ; phic = phi5[i] ; phid = phi4[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x32 ;  yab =  y32 ;  zab =  z32 ;
      dax = -s72xs42x ;  day = -s72xs42y ;  daz = -s72xs42z ;
      dbx =  s73xs43x ;  dby =  s73xs43y ;  dbz =  s73xs43z ;
      dcx =  s73xs32x ;  dcy =  s73xs32y ;  dcz =  s73xs32z ;
      ddx = -s43xs32x ;  ddy = -s43xs32y ;  ddz = -s43xs32z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t1c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t1c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t1c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t1c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t1c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t1c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi3[i] ; phib = phi2[i] ; phic = phi4[i] ; phid = phi7[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x62 ;  yab =  y62 ;  zab =  z62 ;
      dax =  s72xs52x ;  day =  s72xs52y ;  daz =  s72xs52z ;
      dbx =  s76xs65x ;  dby =  s76xs65y ;  dbz =  s76xs65z ;
      dcx = -s65xs62x ;  dcy = -s65xs62y ;  dcz = -s65xs62z ;
      ddx = -s76xs62x ;  ddy = -s76xs62y ;  ddz = -s76xs62z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t2c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t2c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t2c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t2c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t2c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t2c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi6[i] ; phib = phi2[i] ; phic = phi7[i] ; phid = phi5[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x84 ;  yab =  y84 ;  zab =  z84 ;
      dax = -s74xs54x ;  day = -s74xs54y ;  daz = -s74xs54z ;
      dbx =  s87xs85x ;  dby =  s87xs85y ;  dbz =  s87xs85z ;
      dcx = -s87xs84x ;  dcy = -s87xs84y ;  dcz = -s87xs84z ;
      ddx =  s85xs84x ;  ddy =  s85xs84y ;  ddz =  s85xs84z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t3c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t3c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t3c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t3c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t3c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t3c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi8[i] ; phib = phi4[i] ; phic = phi5[i] ; phid = phi7[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x72 ;  yab =  y72 ;  zab =  z72 ;
      dax = -s52xs42x ;  day = -s52xs42y ;  daz = -s52xs42z ;
      dbx =  s75xs74x ;  dby =  s75xs74y ;  dbz =  s75xs74z ;
      dcx = -s75xs72x ;  dcy = -s75xs72y ;  dcz = -s75xs72z ;
      ddx =  s74xs72x ;  ddy =  s74xs72y ;  ddz =  s74xs72z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t4c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t4c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t4c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t4c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t4c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t4c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi7[i] ; phib = phi2[i] ; phic = phi4[i] ; phid = phi5[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x21 ;  yab =  y21 ;  zab =  z21 ;
      dax = -s61xs31x ;  day = -s61xs31y ;  daz = -s61xs31z ;
      dbx =  s62xs32x ;  dby =  s62xs32y ;  dbz =  s62xs32z ;
      dcx =  s62xs21x ;  dcy =  s62xs21y ;  dcz =  s62xs21z ;
      ddx = -s32xs21x ;  ddy = -s32xs21y ;  ddz = -s32xs21z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t5c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t5c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t5c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t5c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t5c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t5c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi2[i] ; phib = phi1[i] ; phic = phi3[i] ; phid = phi6[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x41 ;  yab =  y41 ;  zab =  z41 ;
      dax =  s81xs31x ;  day =  s81xs31y ;  daz =  s81xs31z ;
      dbx =  s84xs43x ;  dby =  s84xs43y ;  dbz =  s84xs43z ;
      dcx = -s43xs41x ;  dcy = -s43xs41y ;  dcz = -s43xs41z ;
      ddx = -s84xs41x ;  ddy = -s84xs41y ;  ddz = -s84xs41z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t6c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t6c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t6c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t6c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t6c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t6c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi4[i] ; phib = phi1[i] ; phic = phi8[i] ; phid = phi3[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x51 ;  yab =  y51 ;  zab =  z51 ;
      dax = -s81xs61x ;  day = -s81xs61y ;  daz = -s81xs61z ;
      dbx =  s85xs65x ;  dby =  s85xs65y ;  dbz =  s85xs65z ;
      dcx =  s85xs51x ;  dcy =  s85xs51y ;  dcz =  s85xs51z ;
      ddx = -s65xs51x ;  ddy = -s65xs51y ;  ddz = -s65xs51z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t7c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t7c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t7c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t7c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t7c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t7c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi5[i] ; phib = phi1[i] ; phic = phi6[i] ; phid = phi8[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x73 ;  yab =  y73 ;  zab =  z73 ;
      dax =  s83xs63x ;  day =  s83xs63y ;  daz =  s83xs63z ;
      dbx =  s87xs76x ;  dby =  s87xs76y ;  dbz =  s87xs76z ;
      dcx = -s76xs73x ;  dcy = -s76xs73y ;  dcz = -s76xs73z ;
      ddx = -s87xs73x ;  ddy = -s87xs73y ;  ddz = -s87xs73z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t8c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t8c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t8c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t8c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t8c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t8c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi7[i] ; phib = phi3[i] ; phic = phi8[i] ; phid = phi6[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      xab =  x61 ;  yab =  y61 ;  zab =  z61 ;
      dax = -s81xs31x ;  day = -s81xs31y ;  daz = -s81xs31z ;
      dbx = -s86xs63x ;  dby = -s86xs63y ;  dbz = -s86xs63z ;
      dcx =  s86xs61x ;  dcy =  s86xs61y ;  dcz =  s86xs61z ;
      ddx =  s63xs61x ;  ddy =  s63xs61y ;  ddz =  s63xs61z ;
      dotx = xab*dax + yab*day + zab*daz ;
      w  = twelfth / (dotx + ptiny) ; 
      wl = w ;
      t9c1[i] += (dax*dbx + day*dby + daz*dbz) * w ;
      t9c2[i] += (dax*dcx + day*dcy + daz*dcz) * w ;
      t9c3[i] += (dax*ddx + day*ddy + daz*ddz) * w ;
      t9c4[i] += (dbx*dcx + dby*dcy + dbz*dcz) * w ;
      t9c5[i] += (dbx*ddx + dby*ddy + dbz*ddz) * w ;
      t9c6[i] += (dcx*ddx + dcy*ddy + dcz*ddz) * w ;
      phia = phi6[i] ; phib = phi1[i] ; phic = phi3[i] ; phid = phi8[i] ;
      flmtx = ( dax*phia + dbx*phib + dcx*phic + ddx*phid ) * wl ;
      flmty = ( day*phia + dby*phib + dcy*phic + ddy*phid ) * wl ;
      flmtz = ( daz*phia + dbz*phib + dcz*phic + ddz*phid ) * wl ;
      flmt[i] += sqrt(flmtx*flmtx + flmty*flmty + flmtz*flmtz) ;
      flmt[i] = fscl*flmt[i] / ( phi1[i] + phi2[i] + phi3[i] + phi4[i] +
                                 phi5[i] + phi6[i] + phi7[i] + phi8[i] +
                                 umin ) ;
   }
   myflops += 1264.*(domain->lpz - domain->frz + 1) ;
   FREEMEM(xc) ;
   FREEMEM(yc) ;
   FREEMEM(zc) ;
   FT_FINALIZE(me, domain->hash, myflops)
}
